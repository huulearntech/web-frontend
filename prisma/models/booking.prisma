model Booking {
  id          String         @id @default(cuid())
  userId      String
  hotelId     String
  startDate   DateTime
  endDate     DateTime
  status      BookingStatus  @default(PENDING)
  totalPrice  Decimal
  notes       String?
  bookingRooms BookingRoom[]
  review      Review?        // optional review for this booking (one review per booking)
  user        User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotel       Hotel          @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  // TODO: add coupon(s)

  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  @@index([userId])
  @@index([hotelId])
  @@index([startDate, endDate])
  @@map("bookings")
}

model BookingRoom {
  id            String   @id @default(cuid())
  bookingId     String
  roomId        String
  pricePerNight Decimal
  nights        Int
  totalPrice    Decimal
  booking       Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)
  room          Room     @relation(fields: [roomId], references: [id], onDelete: Cascade)

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([bookingId, roomId])
  @@index([roomId])
  @@index([bookingId])
  @@map("booking_rooms")
}

model Review {
  id        String   @id @default(cuid())
  bookingId String   @unique
  rating    Int      // 1..5
  comment   String?
  createdAt DateTime @default(now())

  booking   Booking  @relation(fields: [bookingId], references: [id], onDelete: Cascade)

  @@map("reviews")
}
enum BookingStatus {
  PENDING
  CONFIRMED
  CANCELLED
  COMPLETED
}

model Coupon {
  id          String   @id @default(cuid())
  code        String   @unique
  description String?
  discountPct Int
  validFrom   DateTime
  validTo     DateTime
  usageLimit  Int?     // null means unlimited
  usedCount   Int      @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("coupons")
}