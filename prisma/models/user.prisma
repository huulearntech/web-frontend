enum UserRole {
  ADMIN
  HOTEL_OWNER
  USER
}

model User {
  id              String            @id @default(cuid())
  email           String            @unique
  password        String
  name            String?
  role            UserRole          @default(USER)
  profileImageUrl String?           @map("profile_image_url")

  // relations
  sessions        Session[]
  favorites       Favorite[]
  recentlyViewed  RecentlyViewed[]
  bookings        Booking[]         // bookings made by this user

  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  @@map("users")
}

model Session {
  id           String   @id @default(cuid())
  userId       String   @map("user_id")
  sessionToken String   @unique @map("session_token")
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@map("sessions")
}

model VerificationToken {
  identifier String   @map("identifier")
  token      String   @map("token")
  expires    DateTime

  @@unique([identifier, token])
  @@map("verification_tokens")
}

// Many-to-many with metadata for favorites
model Favorite {
  id        String   @id @default(cuid())
  userId    String
  hotelId   String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())

  @@unique([userId, hotelId])
  @@index([hotelId])
  @@index([userId])
  @@map("favorites")
}

// Recently viewed entries (keeps history, query most recent)
model RecentlyViewed {
  id        String   @id @default(cuid())
  userId    String
  hotelId   String
  viewedAt  DateTime @default(now())
  meta      Json?    // optional: store snapshot like name/price for faster UI

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  hotel     Hotel    @relation(fields: [hotelId], references: [id], onDelete: Cascade)

  @@index([userId, viewedAt])
  @@index([hotelId, viewedAt])
  @@map("recently_viewed")
}
